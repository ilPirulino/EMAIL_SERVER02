<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server per Report di Interventi Tecnici</title>
    <link rel="stylesheet" href="frontend/style.css">
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
</head>
<body>
    <div class="page-container">
        <header>
            <h1 class="common-title">SERVER PER REPORT DI INTERVENTI TECNICI</h1>
        </header>
        <main>
            <section class="send-email">
                <h2>Invia Email</h2>
                <div class="form-container">
                    <div class="form-group">
                        <label for="sender">Nome Mittente</label>
                        <input type="text" id="sender" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="to">A (Email)</label>
                        <input type="email" id="to" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="subject">Oggetto</label>
                        <input type="text" id="subject" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="replyto">Rispondi a (Email)</label>
                        <input type="email" id="replyto" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="message">Messaggio</label>
                        <textarea id="message" class="form-control" cols="40" rows="8"></textarea>
                    </div>
                    <button onclick="sendMail();" class="btn">Invia</button>
                </div>
            </section>
            <section class="reports-reply">
                <h2>Report e Risposta</h2>
                <div class="form-group">
                    <label for="saved-emails">Email Salvate</label>
                    <select id="saved-emails" class="form-control">
                        <option value="">Scegli un indirizzo</option>
                    </select>
                </div>
            </section>
        </main>
    </div>

    <script>
        function sendMail() {
            emailjs.init("my7cTzIrXbJyZf_0z");

            var link1 = "<br><a href=\"https://ilpirulino.github.io/EMAIL_SERVER02/\">Link Sito</a>";
            var link2 = "<br><a href=\"https://orionsrl-my.sharepoint.com/:b:/r/personal/a_bigon_orion-srl_it/Documents/Report_prova02.5.pdf?csf=1&web=1&e=YCexHk/\">Link PDF</a>";

            var params = {
                Sender: document.querySelector("#sender").value,
                To: document.querySelector("#to").value ? document.querySelector("#to").value : document.querySelector("#saved-emails").value,
                Subject: document.querySelector("#subject").value,
                replyto: document.querySelector("#replyto").value,
                message: document.querySelector("#message").value + link1 + link2,
            };

            emailjs.send("service_plf6iaf", "template_3hhhd3d", params)
                .then(res => {
                    alert("Email inviata con successo!");
                })
                .catch(err => {
                    console.error("Errore durante l'invio dell'email:", err);
                    alert("Impossibile inviare l'email. Si prega di riprovare piÃ¹ tardi.");
                });
        }

        async function loadAddresses() {
            try {
                const response = await fetch('frontend/Files/address_options.txt');
                const data = await response.text();
                const options = data.split('\n').map(option => option.trim()).filter(option => option);
                const dropdownMenu = document.getElementById("saved-emails");
                dropdownMenu.innerHTML = '<option value="">Scegli un indirizzo</option>';
                options.forEach(option => {
                    const optionElement = document.createElement('option');
                    optionElement.value = option;
                    optionElement.textContent = option;
                    dropdownMenu.appendChild(optionElement);
                });
            } catch (error) {
                console.error('Errore durante il caricamento degli indirizzi:', error);
            }
        }

        function initialize() {
            loadAddresses();
        }

        window.onload = initialize;
    </script>
</body>
</html>
